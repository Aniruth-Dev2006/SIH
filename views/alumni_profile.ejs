<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile | Alumnium</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/alumni.css">
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>

    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            if (savedTheme === 'dark') { document.documentElement.classList.add('dark'); }
        })();
    </script>

    <div class="sidebar-backdrop" id="sidebarBackdrop"></div>
    <div class="dashboard-layout">
        <%- include('partials/alumni-sidebar', { currentPage: 'profile', alumni: alumni }) %>

        <main class="main-content">
            <div class="mobile-header d-lg-none mb-4">
                <h1 class="h2">My Profile</h1>
                <button class="btn btn-light" type="button" id="sidebarToggle"><i class="bi bi-list"></i></button>
            </div>

            <!-- Profile Header -->
            <div class="profile-header text-center">
                <img src="<%= alumni.profilePicture || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(alumni.name) + '&background=6366f1&color=fff&size=200' %>" 
                     alt="<%= alumni.name %>" 
                     class="profile-avatar mb-3">
                <h2 class="mb-2"><%= alumni.name %></h2>
                <p class="mb-1"><%= alumni.company || 'Company Not Specified' %> <% if (alumni.designation) { %>• <%= alumni.designation %><% } %></p>
                <p class="mb-0"><i class="bi bi-geo-alt-fill me-2"></i><%= alumni.location || 'Location Not Specified' %></p>
                <div class="mt-3">
                    <a href="/alumni-edit-profile" class="btn btn-light me-2">
                        <i class="bi bi-pencil-square me-2"></i>Edit Profile
                    </a>
                    <button class="btn btn-outline-light" onclick="window.print()">
                        <i class="bi bi-download me-2"></i>Download CV
                    </button>
                </div>
            </div>

            <!-- Stats Row -->
            <div class="row g-4 mb-4">
                <div class="col-md-3">
                    <div class="stat-box">
                        <div class="stat-number"><%= stats.connections %></div>
                        <div class="stat-label">Connections</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-box">
                        <div class="stat-number"><%= stats.mentees %></div>
                        <div class="stat-label">Mentees</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-box">
                        <div class="stat-number"><%= stats.eventsAttended %></div>
                        <div class="stat-label">Events Attended</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-box">
                        <div class="stat-number">₹<%= (stats.totalDonations / 1000).toFixed(1) %>K</div>
                        <div class="stat-label">Total Donations</div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-8">
                    <!-- Personal Information -->
                    <div class="info-card">
                        <h5 class="mb-3"><i class="bi bi-person-fill me-2"></i>Personal Information</h5>
                        <div class="info-item">
                            <span class="info-label">Full Name</span>
                            <span class="info-value"><%= alumni.name %></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Email</span>
                            <span class="info-value"><%= alumni.email %></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Phone</span>
                            <span class="info-value"><%= alumni.phone || 'Not Provided' %></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Date of Birth</span>
                            <span class="info-value"><%= alumni.dob ? new Date(alumni.dob).toLocaleDateString() : 'Not Provided' %></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Gender</span>
                            <span class="info-value"><%= alumni.gender || 'Not Specified' %></span>
                        </div>
                    </div>

                    <!-- Educational Background -->
                    <div class="info-card">
                        <h5 class="mb-3"><i class="bi bi-mortarboard-fill me-2"></i>Educational Background</h5>
                        <div class="info-item">
                            <span class="info-label">Department</span>
                            <span class="info-value"><%= alumni.dept %></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Batch</span>
                            <span class="info-value"><%= alumni.batch %></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Roll Number</span>
                            <span class="info-value"><%= alumni.rno %></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Course</span>
                            <span class="info-value"><%= alumni.course || 'Not Specified' %></span>
                        </div>
                    </div>

                    <!-- Professional Information -->
                    <div class="info-card">
                        <h5 class="mb-3"><i class="bi bi-briefcase-fill me-2"></i>Professional Information</h5>
                        <div class="info-item">
                            <span class="info-label">Current Company</span>
                            <span class="info-value"><%= alumni.company || 'Not Specified' %></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Designation</span>
                            <span class="info-value"><%= alumni.designation || 'Not Specified' %></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Years of Experience</span>
                            <span class="info-value"><%= alumni.experience || 'Not Specified' %></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Industry</span>
                            <span class="info-value"><%= alumni.industry || 'Not Specified' %></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">LinkedIn</span>
                            <span class="info-value">
                                <% if (alumni.linkedin) { %>
                                    <a href="<%= alumni.linkedin %>" target="_blank" class="text-primary">
                                        <i class="bi bi-linkedin me-1"></i>View Profile
                                    </a>
                                <% } else { %>
                                    Not Provided
                                <% } %>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <!-- Bio -->
                    <div class="info-card">
                        <h5 class="mb-3"><i class="bi bi-card-text me-2"></i>Bio</h5>
                        <p class="text-muted-foreground">
                            <%= alumni.bio || 'No bio added yet. Edit your profile to add a bio.' %>
                        </p>
                    </div>

                    <!-- Skills -->
                    <div class="info-card">
                        <h5 class="mb-3"><i class="bi bi-lightbulb-fill me-2"></i>Skills</h5>
                        <% if (alumni.skills && alumni.skills.length > 0) { %>
                            <div class="d-flex flex-wrap gap-2">
                                <% alumni.skills.forEach(skill => { %>
                                    <span class="badge bg-primary"><%= skill %></span>
                                <% }) %>
                            </div>
                        <% } else { %>
                            <p class="text-muted-foreground small mb-0">No skills added yet.</p>
                        <% } %>
                    </div>

                    <!-- Achievements -->
                    <div class="info-card">
                        <h5 class="mb-3"><i class="bi bi-award-fill me-2"></i>Achievements</h5>
                        <% if (alumni.achievements && alumni.achievements.length > 0) { %>
                            <ul class="list-unstyled">
                                <% alumni.achievements.forEach(achievement => { %>
                                    <li class="mb-2">
                                        <i class="bi bi-check-circle-fill text-success me-2"></i>
                                        <%= achievement %>
                                    </li>
                                <% }) %>
                            </ul>
                        <% } else { %>
                            <p class="text-muted-foreground small mb-0">No achievements added yet.</p>
                        <% } %>
                    </div>

                    <!-- Social Links -->
                    <div class="info-card">
                        <h5 class="mb-3"><i class="bi bi-share-fill me-2"></i>Social Links</h5>
                        <div class="d-flex gap-3">
                            <% if (alumni.linkedin) { %>
                                <a href="<%= alumni.linkedin %>" target="_blank" class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-linkedin"></i>
                                </a>
                            <% } %>
                            <% if (alumni.github) { %>
                                <a href="<%= alumni.github %>" target="_blank" class="btn btn-outline-dark btn-sm">
                                    <i class="bi bi-github"></i>
                                </a>
                            <% } %>
                            <% if (alumni.twitter) { %>
                                <a href="<%= alumni.twitter %>" target="_blank" class="btn btn-outline-info btn-sm">
                                    <i class="bi bi-twitter"></i>
                                </a>
                            <% } %>
                            <% if (!alumni.linkedin && !alumni.github && !alumni.twitter) { %>
                                <p class="text-muted-foreground small mb-0">No social links added yet.</p>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Mobile sidebar toggle
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarBackdrop = document.getElementById('sidebarBackdrop');

        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('show');
                document.body.classList.toggle('sidebar-open');
            });
        }

        if (sidebarBackdrop) {
            sidebarBackdrop.addEventListener('click', () => {
                sidebar.classList.remove('show');
                document.body.classList.remove('sidebar-open');
            });
        }

        // Show success message if redirected after profile update
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('updated') === 'true') {
            showToast('Success', 'Profile updated successfully!', 'success');
        }

        function showToast(title, message, type) {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            const bgClass = type === 'success' ? 'bg-success' : type === 'danger' ? 'bg-danger' : 'bg-info';
            
            const toastHtml = `
                <div id="${toastId}" class="toast align-items-center text-white ${bgClass} border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            <strong>${title}</strong><br>${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, { autohide: true, delay: 4000 });
            toast.show();
            
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        }
    </script>
</body>
</html>
